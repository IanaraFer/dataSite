function downloadReport(type) {
    let content, filename;
    
    if (type === 'full-report') {
        content = generateFullReport();
        filename = 'AnalyticaCore_Business_Analysis_Report.pdf';
    } else if (type === 'forecast') {
        content = generateForecastData();
        filename = 'AnalyticaCore_Forecast_Data.csv';
    } else if (type === 'insights') {
        content = generateInsights();
        filename = 'AnalyticaCore_AI_Insights.txt';
    }
    
    // Create download
    const blob = new Blob([content], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.click();
    window.URL.revokeObjectURL(url);
    
    // Show download message
    showDownloadMessage(type);
}

function generateFullReport() {
    return `ANALYTICACORE AI - BUSINESS ANALYSIS REPORT
=====================================

CLIENT: E-commerce Business Analysis
DATASET: 50,000 transactions
ANALYSIS DATE: ${new Date().toLocaleDateString()}

EXECUTIVE SUMMARY
-----------------
• Total Revenue: €2.4M (+18% growth)
• Customer Base: 23,847 customers (+14% growth)
• Top Performing Region: Europe (42% market share)
• Key Opportunity: Asia expansion potential (+67% growth)

REVENUE ANALYSIS
----------------
Total Revenue: €2,400,000
Monthly Growth Rate: 12.3%
Average Order Value: €48.50 (+5% improvement)
Peak Sales Day: Friday (€387K average)

CUSTOMER INSIGHTS
-----------------
Total Customers: 23,847
Repeat Customer Rate: 68%
Customer Lifetime Value: €156 (+23% increase)
Churn Rate: 8.2% (-3.1% improvement)

PRODUCT PERFORMANCE
------------------
Top Category: Electronics (€890K revenue)
Fastest Growing: Home & Garden (+45% growth)
Highest Margin: Books (42% profit margin)
Inventory Turnover: 6.8x annually

GEOGRAPHIC ANALYSIS
------------------
Europe: 42% market share (Top performer)
Asia: 67% growth rate (High potential)
North America: €65.30 AOV (Highest value)
Market Presence: 23 countries (+4 new markets)

CHANNEL PERFORMANCE
------------------
Online Revenue: €1.8M (75% of total)
Store Revenue: €600K (25% of total)
Mobile Conversion: 3.8% (+0.9% improvement)
Best Channel: Email Marketing (8.2% conversion)

SEASONAL PATTERNS
-----------------
Peak Period: Q4 (November-December, +156%)
Best Month: December (€420K revenue)
Weekday vs Weekend: 65% vs 35%
Summer Dip: July-August (-23% decline)

AI RECOMMENDATIONS
------------------
1. REVENUE OPTIMIZATION
   Asia region expansion could generate €300K additional revenue
   Recommended investment: €50K marketing budget

2. INVENTORY MANAGEMENT
   Electronics category return rate optimization
   Potential savings: €75K annually

3. CUSTOMER RETENTION
   Cross-selling books to electronics customers
   Expected revenue increase: 12%

PREDICTIVE ANALYTICS
-------------------
Next Month Revenue Forecast: €284K (95% confidence)
New Customer Acquisition: 2,340 customers expected
Churn Risk Customers: 847 customers require attention
Recommended Inventory Investment: €156K

CONCLUSION
----------
Strong business foundation with significant growth opportunities.
Focus areas: Asia expansion, inventory optimization, customer retention.
Expected ROI: 15-25% improvement with recommended actions.

Generated by AnalyticaCore AI
For full platform access: https://analyticacoreai.netlify.app
Contact: hello@analyticacoreai.ie`;
}

function generateForecastData() {
    return `Date,Revenue_Forecast,Customers_Forecast,Orders_Forecast,Confidence
2024-09-01,284000,2340,5850,0.95
2024-10-01,312000,2580,6420,0.93
2024-11-01,445000,3680,9200,0.91
2024-12-01,520000,4320,10800,0.89
2025-01-01,298000,2450,6125,0.87
2025-02-01,315000,2590,6475,0.85
2025-03-01,338000,2780,6950,0.83

# Seasonal Adjustments Applied
# Growth Factors Included
# Market Trends Analyzed
# Generated by AnalyticaCore AI`;
}

function generateInsights() {
    return `ANALYTICACORE AI - BUSINESS INSIGHTS REPORT
==========================================

🎯 KEY OPPORTUNITIES IDENTIFIED

1. ASIA MARKET EXPANSION
   Current Performance: 18% market share, 67% growth rate
   Opportunity: Increase marketing budget by €50K
   Expected Return: €300K additional revenue
   Timeline: 3-6 months
   Confidence: High (89%)

2. INVENTORY OPTIMIZATION
   Issue: Electronics category 15% higher return rate in Q2
   Solution: Implement seasonal inventory adjustments
   Savings Potential: €75K annually
   Implementation: Immediate
   Confidence: Very High (94%)

3. CUSTOMER RETENTION ENHANCEMENT
   Insight: Books customers have highest LTV (€203) but lowest acquisition
   Strategy: Cross-sell books to Electronics customers
   Revenue Impact: +12% overall revenue
   Timeline: 2-3 months
   Confidence: High (87%)

⚠️ RISK ALERTS

1. SUMMER REVENUE DIP
   Pattern: 23% decline in July-August
   Recommendation: Develop summer-specific marketing campaigns
   Mitigation: Seasonal product lines, vacation-themed promotions

2. MOBILE CONVERSION GAP
   Current Rate: 3.8% (below industry average of 5.2%)
   Action Required: Mobile UX optimization
   Potential Gain: +€180K annual revenue

3. CUSTOMER CHURN CONCENTRATION
   Risk: 847 customers show churn indicators
   Intervention: Personalized retention campaigns
   Success Rate: 67% retention possible with targeted approach

📈 GROWTH RECOMMENDATIONS

1. FRIDAY SALES AMPLIFICATION
   Insight: Friday is peak sales day (€387K average)
   Strategy: Thursday email campaigns, Friday flash sales
   Expected Boost: +15% Friday revenue

2. REGIONAL EXPANSION PRIORITY
   Order: Asia > North America > New Markets
   Investment Ratio: 60% Asia, 30% North America, 10% New
   ROI Timeline: 6-12 months

3. PRODUCT CATEGORY OPTIMIZATION
   Electronics: Focus on return reduction
   Home & Garden: Scale inventory for 45% growth
   Books: Increase visibility and cross-promotion

🔮 PREDICTIVE INSIGHTS

NEXT 90 DAYS:
• Revenue will peak in month 3 (likely November)
• Customer acquisition will increase by 35%
• Inventory turnover will accelerate to 7.2x

NEXT 6 MONTHS:
• Strong growth trajectory maintained
• Asia market share could reach 28%
• Overall revenue growth: 22-28%

💡 IMPLEMENTATION ROADMAP

MONTH 1:
□ Launch Asia marketing campaign (€50K budget)
□ Implement Electronics return process optimization
□ Begin Books cross-selling to Electronics customers

MONTH 2:
□ Deploy mobile UX improvements
□ Start Friday sales amplification program
□ Initiate customer churn intervention campaigns

MONTH 3:
□ Analyze Asia expansion results
□ Scale successful retention strategies
□ Prepare for Q4 seasonal surge

Generated by AnalyticaCore AI on ${new Date().toLocaleDateString()}
Platform: https://analyticacoreai.netlify.app
Support: hello@analyticacoreai.ie`;
}

function showDownloadMessage(type) {
    const messages = {
        'full-report': 'Full Business Analysis Report downloaded! 📊',
        'forecast': 'Revenue Forecast Data downloaded! 📈',
        'insights': 'AI Business Insights downloaded! 🤖'
    };
    
    // Create temporary notification
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        z-index: 1000;
        font-weight: bold;
        animation: slideIn 0.3s ease;
    `;
    notification.innerHTML = messages[type];
    
    document.body.appendChild(notification);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
}

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(style);
// File upload handler
function handleFileUpload(input) {
    const files = input.files;
    const status = document.getElementById('uploadStatus');
    
    if (files.length > 0) {
        status.innerHTML = `<i class="fas fa-check-circle"></i> ${files.length} file(s) selected! Processing...`;
        
        // Simulate processing
        setTimeout(() => {
            status.innerHTML = `<i class="fas fa-sparkles"></i> Analysis complete! See results below.`;
        }, 2000);
    }
}

// Show download message
function showDownloadMessage(type) {
    const messages = {
        'full-report': 'Full Business Analysis Report downloaded!',
        'forecast': 'Forecast Data CSV downloaded!',
        'insights': 'AI Insights Report downloaded!'
    };
    
    // Create a temporary message
    const msg = document.createElement('div');
    msg.style.cssText = `
        position: fixed; top: 20px; right: 20px; 
        background: #4CAF50; color: white; 
        padding: 15px 20px; border-radius: 5px; 
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        z-index: 1000; font-weight: bold;
    `;
    msg.innerHTML = `<i class="fas fa-check-circle"></i> ${messages[type]}`;
    
    document.body.appendChild(msg);
    
    setTimeout(() => {
        document.body.removeChild(msg);
    }, 3000);
}


// Enhanced download function with proper file types
function downloadReportEnhanced(type) {
    let content, filename, mimeType;

    if (type === 'full-report') {
        content = generateFullReport();
        filename = 'AnalyticaCore_Business_Analysis_Report.txt';
        mimeType = 'text/plain';
    } else if (type === 'forecast') {
        content = generateForecastCSV();
        filename = 'AnalyticaCore_Forecast_Data.csv';
        mimeType = 'text/csv';
    } else if (type === 'insights') {
        content = generateInsights();
        filename = 'AnalyticaCore_AI_Insights.json';
        mimeType = 'application/json';
    }

    // Create proper blob with correct MIME type
    const blob = new Blob([content], { type: mimeType });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.style.display = 'none';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);

    // Show download message
    showDownloadMessage(type);
}

// Generate proper CSV format for forecast data
function generateForecastCSV() {
    return `Month,Revenue_Forecast,Growth_Rate,Confidence_Level
Jan 2025,€285000,12.5%,92%
Feb 2025,€298000,14.2%,89%
Mar 2025,€312000,16.8%,91%
Apr 2025,€328000,18.3%,88%
May 2025,€342000,19.7%,90%
Jun 2025,€356000,21.2%,87%
Jul 2025,€371000,22.8%,89%
Aug 2025,€386000,24.1%,91%
Sep 2025,€402000,25.6%,88%
Oct 2025,€418000,27.2%,90%
Nov 2025,€435000,28.8%,92%
Dec 2025,€453000,30.4%,89%`;
}

// Generate JSON format for insights
function generateInsightsJSON() {
    const insights = {
        "analysis_date": new Date().toISOString(),
        "dataset": "E-commerce Business Data",
        "total_transactions": 50000,
        "key_insights": [
            {
                "category": "Revenue Optimization",
                "insight": "Asia region shows 67% growth but only 18% market share",
                "recommendation": "Increase marketing budget by €50K in Asia",
                "potential_impact": "€300K additional revenue",
                "confidence": 92
            },
            {
                "category": "Risk Management",
                "insight": "Electronics category has 15% higher return rate in Q2",
                "recommendation": "Implement seasonal inventory adjustments",
                "potential_impact": "€75K cost reduction annually",
                "confidence": 88
            },
            {
                "category": "Customer Retention",
                "insight": "Book customers have highest LTV (€203) but lowest acquisition",
                "recommendation": "Cross-sell books to Electronics customers",
                "potential_impact": "12% revenue increase",
                "confidence": 94
            }
        ],
        "performance_metrics": {
            "total_revenue": "€2,400,000",
            "growth_rate": "18%",
            "customer_base": 23847,
            "average_order_value": "€48.50"
        }
    };
    
    return JSON.stringify(insights, null, 2);
}

