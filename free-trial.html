<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Trial - AnalyticaCore AI</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
        <h1>Free Trial Request</h1>
        <form id="freeTrialForm">
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" id="name" name="name" required />
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" required />
            </div>
            <div class="form-group">
                <label for="company">Company</label>
                <input type="text" id="company" name="company" />
            </div>
            <div class="form-group">
                <label for="file">Upload File</label>
                <input type="file" id="file" name="file" />
            </div>
            <div class="form-group">
                <label for="message">Message</label>
                <textarea id="message" name="message"></textarea>
            </div>
            <button type="submit">Submit Free Trial</button>
        </form>
        <div id="formStatus"></div>
        <script>
            document.getElementById('freeTrialForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const form = e.target;
                const formData = new FormData(form);
                const data = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    company: formData.get('company'),
                    message: formData.get('message')
                };
                document.getElementById('formStatus').textContent = 'Sending...';
                try {
                    const response = await fetch('/.netlify/functions/free-trial-email', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    const text = await response.text();
                    document.getElementById('formStatus').textContent = text;
                    form.reset();
                } catch (err) {
                    document.getElementById('formStatus').textContent = 'Error sending form.';
                }
            });
        </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FREE AI Business Health Check - DataSight AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c5aa0;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }

        .hidden-file-input {
            display: none;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 80px 0;
        }

        .feature-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .cta-button {
            background: var(--warning-color);
            color: #000;
            font-weight: bold;
            font-size: 1.2rem;
            padding: 15px 30px;
            border-radius: 50px;
            border: none;
            transition: all 0.3s ease;
        }

        .cta-button:hover {
            background: #e0a800;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .testimonial-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            border-left: 5px solid var(--primary-color);
        }

        .countdown-timer {
            background: var(--danger-color);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 30px 0;
        }

        .benefit-check {
            color: var(--success-color);
            font-weight: bold;
        }

        .form-section {
            background: #f8f9fa;
            padding: 60px 0;
        }

        .trust-badges {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin: 40px 0;
        }

        .value-prop {
            background: var(--warning-color);
            color: #000;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 20px;
        }

        .uploaded-file-name {
            display: none;
        }

        .urgency-banner {
            background: var(--danger-color);
            color: white;
            text-align: center;
            padding: 10px;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        body {
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <!-- Urgency Banner -->
    <div class="urgency-banner">
        <strong>‚è∞ LIMITED TIME:</strong> Free AI Health Check - Only 50 Spots Available This Week!
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-7">
                    <div class="value-prop">
                        üî• Worth ‚Ç¨500 - Yours FREE Today
                    </div>
                    <h1 class="display-4 fw-bold mb-4">Get Your FREE AI Business Health Check</h1>
                    <h3 class="mb-4">Discover Hidden Profit Opportunities in Your Business Data</h3>
                    <p class="lead mb-4">
                        Upload your business data and get a professional AI analysis in just 15 minutes. 
                        See exactly how much revenue you're leaving on the table.
                    </p>
                    
                    <div class="row text-center mb-4">
                        <div class="col-md-4">
                            <div class="feature-icon text-warning">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h5>Revenue Forecast</h5>
                            <p>Next quarter prediction with 87% accuracy</p>
                        </div>
                        <div class="col-md-4">
                            <div class="feature-icon text-warning">
                                <i class="fas fa-users"></i>
                            </div>
                            <h5>Customer Insights</h5>
                            <p>Your top 3 most profitable customer segments</p>
                        </div>
                        <div class="col-md-4">
                            <div class="feature-icon text-warning">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <h5>Action Plan</h5>
                            <p>5 specific recommendations to increase profits</p>
                        </div>
                    </div>

                    <button class="cta-button" onclick="scrollToForm()">
                        <i class="fas fa-rocket me-2"></i>Get My FREE Analysis Now
                    </button>
                    <p class="mt-3"><small>‚è±Ô∏è Results in 15 minutes ‚Ä¢ üíØ No commitment required ‚Ä¢ üáÆüá™ Irish business experts</small></p>
                </div>
                <div class="col-lg-5">
                    <div class="text-center">
                        <img src="https://via.placeholder.com/500x400/667eea/ffffff?text=AI+Dashboard+Preview" 
                             alt="DataSight AI Dashboard" class="img-fluid rounded shadow-lg">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- What You Get Section -->
    <section class="py-5">
        <div class="container">
            <div class="text-center mb-5">
                <h2 class="display-5 fw-bold">What You'll Receive (Worth ‚Ç¨500)</h2>
                <p class="lead text-muted">Complete AI business analysis delivered to your inbox</p>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="d-flex align-items-start mb-4">
                        <div class="benefit-check me-3 fs-3">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div>
                            <h5>Revenue Prediction Report</h5>
                            <p>AI-powered forecast for your next quarter with confidence intervals and seasonal adjustments. Know exactly what to expect.</p>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-start mb-4">
                        <div class="benefit-check me-3 fs-3">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div>
                            <h5>Customer Segmentation Analysis</h5>
                            <p>Discover your most valuable customer groups, their behavior patterns, and lifetime value calculations.</p>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-start mb-4">
                        <div class="benefit-check me-3 fs-3">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div>
                            <h5>Hidden Opportunity Detection</h5>
                            <p>AI identifies profit opportunities you're missing - cross-selling, pricing optimization, and growth areas.</p>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="d-flex align-items-start mb-4">
                        <div class="benefit-check me-3 fs-3">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div>
                            <h5>Executive Summary Report</h5>
                            <p>Professional 5-page report with key findings, charts, and strategic recommendations ready for stakeholders.</p>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-start mb-4">
                        <div class="benefit-check me-3 fs-3">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div>
                            <h5>Action Plan with ROI Estimates</h5>
                            <p>5 specific actions you can take immediately, with projected revenue impact and implementation difficulty.</p>
                        </div>
                    </div>
                    
                    <div class="d-flex align-items-start mb-4">
                        <div class="benefit-check me-3 fs-3">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div>
                            <h5>15-Minute Strategy Call</h5>
                            <p>Optional call with our Irish AI experts to discuss your results and answer questions about implementation.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Social Proof -->
    <section class="py-5 bg-light">
        <div class="container">
            <div class="text-center mb-5">
                <h3>Join 500+ Irish Businesses Already Using AI Analytics</h3>
            </div>
            
            <div class="row">
                <div class="col-md-4">
                    <div class="testimonial-card">
                        <div class="text-warning mb-3">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p><em>"The free analysis showed us ‚Ç¨180K in missed opportunities. We implemented their recommendations and hit those numbers in just 3 months."</em></p>
                        <strong>- Sarah O'Brien, Operations Director, Dublin Retail Chain</strong>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="testimonial-card">
                        <div class="text-warning mb-3">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p><em>"Their AI predicted our busiest days with 94% accuracy. Game changer for staffing and inventory. Worth every penny."</em></p>
                        <strong>- Michael Murphy, Owner, Cork Restaurant Group</strong>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="testimonial-card">
                        <div class="text-warning mb-3">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p><em>"Finally, analytics that make sense to non-techies. The insights were immediately actionable and profitable."</em></p>
                        <strong>- Emma Walsh, CEO, Galway Tech Services</strong>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Countdown Timer -->
    <section class="py-3">
        <div class="container">
            <div class="countdown-timer">
                <h4><i class="fas fa-clock"></i> Limited Time Offer Expires Soon!</h4>
                <p class="mb-0">Only <strong id="spotsLeft">47</strong> free analysis spots remaining this week</p>
            </div>
        </div>
    </section>

    <!-- Form Section -->
    <section class="form-section" id="form-section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card shadow-lg border-0">
                        <div class="card-body p-5">
                            <div class="text-center mb-4">
                                <h3 class="fw-bold">Get Your FREE AI Business Health Check</h3>
                                <p class="text-muted">Takes less than 2 minutes to complete</p>
                            </div>
                            
                            <form id="healthCheckForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-bold">First Name *</label>
                                        <input type="text" class="form-control form-control-lg" id="firstName" name="firstName" required placeholder="Enter your first name" title="First Name">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-bold">Last Name *</label>
                                        <input type="text" class="form-control form-control-lg" id="lastName" name="lastName" required title="Last Name" placeholder="Enter your last name">
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-bold">Business Email *</label>
                                        <input type="email" class="form-control form-control-lg" id="email" name="email" required title="Business Email" placeholder="Enter your business email">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-bold">Phone Number *</label>
                                        <input type="tel" class="form-control form-control-lg" id="phone" name="phone" required>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-bold">Company Name *</label>
                                        <input type="text" class="form-control form-control-lg" id="company" name="company" required>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-bold">Industry *</label>
                                        <select class="form-select form-select-lg" id="industry" name="industry" required title="Industry">
                                            <option value="">Select Industry</option>
                                            <option value="retail">Retail/E-commerce</option>
                                            <option value="restaurant">Restaurant/Food Service</option>
                                            <option value="manufacturing">Manufacturing</option>
                                            <option value="technology">Technology/Software</option>
                                            <option value="professional">Professional Services</option>
                                            <option value="healthcare">Healthcare</option>
                                            <option value="finance">Financial Services</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Approximate Annual Revenue *</label>
                                    <select class="form-select form-select-lg" id="revenue" name="revenue" required title="Approximate Annual Revenue">
                                        <option value="">Select Revenue Range</option>
                                        <option value="under-500k">Under ‚Ç¨500K</option>
                                        <option value="500k-1m">‚Ç¨500K - ‚Ç¨1M</option>
                                        <option value="1m-5m">‚Ç¨1M - ‚Ç¨5M</option>
                                        <option value="5m-20m">‚Ç¨5M - ‚Ç¨20M</option>
                                        <option value="over-20m">Over ‚Ç¨20M</option>
                                    </select>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label fw-bold">What's your biggest business challenge?</label>
                                    <textarea class="form-control" id="challenge" name="challenge" rows="3" 
                                              placeholder="e.g., Understanding customer behavior, predicting sales, optimizing inventory..."></textarea>
                                </div>

                                <!-- Dataset Upload Section -->
                                <div class="mb-4">
                                    <label class="form-label fw-bold">Upload Your Business Data (Optional)</label>
<<<<<<< HEAD
                                        <input type="file" id="datasetFile" name="datasetFile" class="hidden-file-input" accept=".csv,.xlsx,.xls,.json" onchange="handleDatasetUpload(this)">
                                        <div id="uploadedFileName" class="mt-2 text-success uploaded-file-name">
                                            <i class="fas fa-check-circle me-1"></i>
                                            <span id="fileName"></span>
                                        </div>
=======
                                    <div class="upload-area-small" onclick="console.log('Upload area clicked'); document.getElementById('datasetFile').click()" style="border: 2px dashed #1f77b4; border-radius: 10px; padding: 2rem; text-align: center; background: rgba(31, 119, 180, 0.05); cursor: pointer; transition: all 0.3s ease;">
                                        <i class="fas fa-cloud-upload-alt fs-3 text-primary mb-2"></i>
                                        <h6>Upload CSV, Excel, or Data File</h6>
                                        <p class="text-muted mb-0 small">We'll analyze this data and include insights in your free report</p>
                                        <input type="file" id="datasetFile" name="datasetFile" style="display: none;" accept=".csv,.xlsx,.xls,.json" onchange="console.log('File input changed'); handleDatasetUpload(this)">
>>>>>>> 3a98e9729a50088f85adee2c30f3575fc7a7132d
                                        <div id="uploadedFileName" class="mt-2 text-success" style="display: none;">
                                            <i class="fas fa-check-circle me-1"></i>
                                            <span id="fileName"></span>
                                        </div>
                                    </div>
                                    <small class="text-muted">
                                        <i class="fas fa-info-circle me-1"></i>
                                        Supported: Sales data, customer data, inventory, financial records. Max 10MB. Your data stays secure.
                                    </small>
                                </div>
                                
                                <div class="mb-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="consent" name="consent" required>
                                        <label class="form-check-label" for="consent">
                                            I agree to receive my free AI analysis and occasional emails about DataSight AI. 
                                            You can unsubscribe anytime. <a href="#" class="text-primary">Privacy Policy</a>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="text-center">
                                    <button type="submit" class="cta-button w-100">
                                        <i class="fas fa-rocket me-2"></i>Get My FREE AI Analysis Now
                                    </button>
                                    <p class="mt-3 text-muted">
                                        <i class="fas fa-lock me-1"></i>Your data is secure and will never be shared
                                    </p>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Trust Badges -->
    <section class="py-4">
        <div class="container">
            <div class="trust-badges">
                <div class="text-center">
                    <i class="fas fa-shield-alt fs-1 text-success"></i>
                    <p class="mb-0"><strong>GDPR Compliant</strong></p>
                </div>
                <div class="text-center">
                    <i class="fas fa-flag fs-1 text-primary"></i>
                    <p class="mb-0"><strong>Irish Business</strong></p>
                </div>
                <div class="text-center">
                    <i class="fas fa-award fs-1 text-warning"></i>
                    <p class="mb-0"><strong>Enterprise Ireland</strong></p>
                </div>
                <div class="text-center">
                    <i class="fas fa-users fs-1 text-info"></i>
                    <p class="mb-0"><strong>500+ Customers</strong></p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h5>DataSight AI</h5>
                    <p class="mb-0">Turning Data into Decisions‚ÄîAutomatically</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">
                        üìß datasightai.founders@gmail.com<br>
                        üì± +353 874502058
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        function scrollToForm() {
            document.getElementById('form-section').scrollIntoView({ behavior: 'smooth' });
        }

        // Countdown spots remaining
        let spotsLeft = 47;
        setInterval(() => {
            if (spotsLeft > 20) {
                spotsLeft -= Math.floor(Math.random() * 2) + 1;
                document.getElementById('spotsLeft').textContent = spotsLeft;
            }
        }, 30000);

        // Add some urgency with timer
        function startUrgencyTimer() {
            const now = new Date().getTime();
            const endOfDay = new Date();
            endOfDay.setHours(23, 59, 59, 999);
            const timeLeft = endOfDay.getTime() - now;
            
            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            
            if (hours > 0) {
                document.querySelector('.urgency-banner').innerHTML = 
                    `<strong>‚è∞ HURRY:</strong> Free AI Health Check ends in ${hours}h ${minutes}m - Only ${spotsLeft} spots left!`;
            }
        }

        // Initialize EmailJS (you'll need to set this up)
        emailjs.init("YOUR_PUBLIC_KEY"); // Replace with your EmailJS public key

        // Handle dataset file upload with client-side processing
        function handleDatasetUpload(input) {
            console.log('üîç handleDatasetUpload called');
            console.log('üìÅ Input files:', input.files);
            
            const file = input.files[0];
            if (file) {
                console.log('üìÑ File selected:', file.name, file.size, file.type);
                
                // Validate file
                const validation = validateFile(file);
                console.log('‚úÖ Validation result:', validation);
                
                if (!validation.valid) {
                    alert(validation.message);
                    input.value = '';
                    return;
                }
                
                // Show file info
                const fileNameElement = document.getElementById('fileName');
                const uploadedFileNameElement = document.getElementById('uploadedFileName');
                
                if (fileNameElement) {
                    fileNameElement.textContent = file.name;
                } else {
                    console.error('‚ùå fileName element not found');
                }
                
                if (uploadedFileNameElement) {
                    uploadedFileNameElement.style.display = 'block';
                } else {
                    console.error('‚ùå uploadedFileName element not found');
                }
                
                // Process file client-side
                processFileClientSide(file);
            } else {
                console.log('‚ùå No file selected');
            }
        }
        
        // Validate uploaded file
        function validateFile(file) {
            const maxSize = 10 * 1024 * 1024; // 10MB
            const allowedTypes = ['text/csv', 'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/json'];
            const allowedExtensions = ['.csv', '.xlsx', '.xls', '.json'];
            
            if (file.size > maxSize) {
                return { valid: false, message: 'File size must be less than 10MB' };
            }
            
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            if (!allowedExtensions.includes(fileExtension)) {
                return { valid: false, message: 'Only CSV, Excel, and JSON files are supported' };
            }
            
            return { valid: true };
        }
        
        // Process file client-side and generate preview
        async function processFileClientSide(file) {
            try {
                const fileExtension = file.name.split('.').pop().toLowerCase();
                let data = null;
                
                if (fileExtension === 'csv') {
                    data = await processCSVFile(file);
                } else if (fileExtension === 'json') {
                    data = await processJSONFile(file);
                } else {
                    // For Excel files, we'll just store the file info
                    data = { message: 'Excel file uploaded - will be processed by our team' };
                }
                
                // Store file info and processed data
                window.uploadedDataset = {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    lastModified: file.lastModified,
                    processedData: data,
                    preview: data ? generateDataPreview(data) : null
                };
                
                // Show success message with preview
                showFilePreview(data, file.name);
                
            } catch (error) {
                console.error('File processing error:', error);
                alert('Error processing file: ' + error.message);
            }
        }
        
        // Process CSV file
        function processCSVFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const csv = e.target.result;
                        const lines = csv.split('\n');
                        const headers = lines[0].split(',').map(h => h.trim());
                        const rows = lines.slice(1, 6).map(line => { // First 5 rows for preview
                            const values = line.split(',').map(v => v.trim());
                            const row = {};
                            headers.forEach((header, index) => {
                                row[header] = values[index] || '';
                            });
                            return row;
                        });
                        
                        resolve({
                            headers: headers,
                            rows: rows,
                            totalRows: lines.length - 1,
                            type: 'csv'
                        });
                    } catch (error) {
                        reject(new Error('Invalid CSV format'));
                    }
                };
                reader.onerror = () => reject(new Error('Error reading file'));
                reader.readAsText(file);
            });
        }
        
        // Process JSON file
        function processJSONFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const json = JSON.parse(e.target.result);
                        resolve({
                            data: Array.isArray(json) ? json.slice(0, 5) : [json], // First 5 items for preview
                            totalItems: Array.isArray(json) ? json.length : 1,
                            type: 'json'
                        });
                    } catch (error) {
                        reject(new Error('Invalid JSON format'));
                    }
                };
                reader.onerror = () => reject(new Error('Error reading file'));
                reader.readAsText(file);
            });
        }
        
        // Generate data preview
        function generateDataPreview(data) {
            if (data.type === 'csv') {
                return {
                    summary: `${data.totalRows} rows, ${data.headers.length} columns`,
                    headers: data.headers,
                    sampleRows: data.rows
                };
            } else if (data.type === 'json') {
                return {
                    summary: `${data.totalItems} items`,
                    sampleData: data.data
                };
            }
            return null;
        }
        
        // Show file preview
        function showFilePreview(data, fileName) {
            const previewContainer = document.getElementById('uploadedFileName');
            if (data && data.type) {
                previewContainer.innerHTML = `
                    <i class="fas fa-check-circle me-1"></i>
                    <span id="fileName">${fileName}</span>
                    <div class="mt-2 small text-muted">
                        <strong>Preview:</strong> ${data.type === 'csv' ? 
                            `${data.totalRows} rows, ${data.headers.length} columns` : 
                            `${data.totalItems} items`}
                    </div>
                `;
            } else {
                previewContainer.innerHTML = `
                    <i class="fas fa-check-circle me-1"></i>
                    <span id="fileName">${fileName}</span>
                `;
            }
        }

        // Add drag and drop functionality
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.querySelector('.upload-area-small');
            
            if (uploadArea) {
                uploadArea.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    uploadArea.style.borderColor = '#007bff';
                    uploadArea.style.backgroundColor = '#f8f9ff';
                });
                
                uploadArea.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    uploadArea.style.borderColor = '#1f77b4';
                    uploadArea.style.backgroundColor = 'rgba(31, 119, 180, 0.05)';
                });
                
                uploadArea.addEventListener('drop', function(e) {
                    e.preventDefault();
                    uploadArea.style.borderColor = '#1f77b4';
                    uploadArea.style.backgroundColor = 'rgba(31, 119, 180, 0.05)';
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const fileInput = document.getElementById('datasetFile');
                        fileInput.files = files;
                        handleDatasetUpload(fileInput);
                    }
                });
            }
        });

        // Form submission handler with proper email sending
        document.getElementById('healthCheckForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Show loading state
            const submitButton = this.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
            submitButton.disabled = true;
            
            // Get form data
            const formData = new FormData(this);
            const data = Object.fromEntries(formData);
            
            // Check if file was actually selected
            const fileInput = document.getElementById('datasetFile');
            const actualFile = fileInput.files[0];
            
            console.log('üìÅ File input files:', fileInput.files);
            console.log('üìÑ Actual file:', actualFile);
            console.log('üíæ Window uploaded dataset:', window.uploadedDataset);
            
            // Add dataset info if uploaded
            if (window.uploadedDataset || actualFile) {
                const dataset = window.uploadedDataset || {
                    name: actualFile.name,
                    size: actualFile.size,
                    type: actualFile.type
                };
                
                data.datasetName = dataset.name;
                data.datasetSize = Math.round(dataset.size / 1024) + 'KB';
                data.datasetType = dataset.type;
                data.datasetPreview = dataset.preview ? JSON.stringify(dataset.preview) : null;
                
                // Also add the actual file to FormData if it exists
                if (actualFile) {
                    formData.append('datasetFile', actualFile);
                    console.log('‚úÖ File added to FormData:', actualFile.name);
                }
            }
            
            // Save to localStorage for backup
            const leads = JSON.parse(localStorage.getItem('datasight_leads') || '[]');
            const newLead = {
                ...data,
                timestamp: new Date().toISOString(),
                id: Date.now().toString(),
                status: 'new',
                hasDataset: !!window.uploadedDataset
            };
            leads.push(newLead);
            localStorage.setItem('datasight_leads', JSON.stringify(leads));
            
            // Create comprehensive email content
            const emailSubject = `üöÄ URGENT: New DataSight AI Lead - ${data.firstName} from ${data.company}`;
            const emailBody = `
üöÄ NEW DATASIGHT AI LEAD ALERT!
${window.uploadedDataset ? 'üìä INCLUDES DATASET FOR ANALYSIS!' : ''}

üë§ CONTACT INFORMATION:
Name: ${data.firstName} ${data.lastName}
Company: ${data.company}
Email: ${data.email}
Phone: ${data.phone}

üè¢ BUSINESS DETAILS:
Industry: ${data.industry}
Annual Revenue: ${data.revenue}
Main Challenge: ${data.challenge || 'Not specified'}

${window.uploadedDataset ? `üìä DATASET UPLOADED:
File: ${data.datasetName}
Size: ${data.datasetSize}
Type: ${data.datasetType}
${data.datasetPreview ? `Preview: ${JSON.parse(data.datasetPreview).summary}` : ''}
üî• PRIORITY: High - Customer uploaded data for analysis!` : 'üìù No dataset uploaded - offer to analyze sample data'}

‚è∞ SUBMISSION TIME: ${new Date().toLocaleString()}

üìã IMMEDIATE ACTION REQUIRED:
${window.uploadedDataset ? 
`1. üî• CALL WITHIN 15 MINUTES: ${data.phone} (they uploaded data!)
2. üìä Download and analyze their dataset immediately  
3. üìß Send personalized analysis within 2 hours
4. üí∞ This is a HOT LEAD - they're ready to see results!` :
`1. üìû Call within 24 hours: ${data.phone}
2. üìß Send demo analysis to: ${data.email}
3. üíº Offer to analyze their data
4. üéØ Schedule demo call`}

üí∞ POTENTIAL VALUE: ‚Ç¨${getLeadValue(data.revenue)} opportunity

üéØ PERSONALIZED FOLLOW-UP:
"Hi ${data.firstName}, I see you're interested in AI analytics for ${data.company}. ${window.uploadedDataset ? `I've received your ${data.datasetName} file and I'm analyzing it now. I'll have your personalized insights ready within 2 hours.` : `I'd love to show you how AI can help with ${data.challenge}. Can I analyze a sample of your business data?`}"

---
‚ö° RESPOND IMMEDIATELY for highest conversion rates!
This lead was generated from your DataSight AI free trial page.
            `.trim();

            // Send notification email using multiple methods for reliability
            
            // Method 1: Direct Formspree submission (most reliable)
            const emailFormData = new FormData();
            emailFormData.append('name', `${data.firstName} ${data.lastName}`);
            emailFormData.append('email', data.email);
            emailFormData.append('company', data.company);
            emailFormData.append('phone', data.phone);
            emailFormData.append('industry', data.industry);
            emailFormData.append('revenue', data.revenue);
            emailFormData.append('challenge', data.challenge || 'Not specified');
            emailFormData.append('has_dataset', !!window.uploadedDataset);
            emailFormData.append('dataset_info', window.uploadedDataset ? `${data.datasetName} (${data.datasetSize})` : 'None');
            emailFormData.append('message', emailBody);
            emailFormData.append('_replyto', data.email);
            emailFormData.append('_subject', emailSubject);
            emailFormData.append('_next', window.location.origin + '/website/thank-you.html');

            try {
                const response = await fetch('https://formspree.io/f/xpzgdqrk', {
                    method: 'POST',
                    body: emailFormData
                });
                
                if (response.ok) {
                    console.log('‚úÖ Formspree email sent successfully');
                } else {
                    console.log('‚ö†Ô∏è Formspree error:', response.status, await response.text());
                }
            } catch (error) {
                console.error('‚ùå Formspree failed:', error);
            }

            // Method 2: Backup notification to ensure you get the lead
            try {
                // Send a simple notification via a webhook service
                await fetch('https://webhook.site/2b0e8c5d-6af7-4a6b-9c42-7a8f1e3d5b9e', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        event: 'new_lead',
                        data: data,
                        has_dataset: !!window.uploadedDataset,
                        timestamp: new Date().toISOString(),
                        email_content: emailBody
                    })
                });
            } catch (error) {
                console.log('Webhook notification failed:', error);
            }

            // Method 3: Always-working mailto backup (GUARANTEED to work)
            const mailtoLink = `mailto:analyticacoreai@outlook.com?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;
            
            // Wait 1 second then show success and open email
            setTimeout(() => {
                // Reset button
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
                
                // Open email client with pre-filled email (this ALWAYS works)
                window.open(mailtoLink);
                
                // Show success message
                const datasetMessage = window.uploadedDataset ? 
                    ` Your ${window.uploadedDataset.name} file has been received and will be analyzed within 2 hours.` : 
                    '';
                
                alert(`‚úÖ SUCCESS! Your free AI business health check request has been submitted.${datasetMessage} 

üìß IMPORTANT: An email will open now - please click SEND to notify our team immediately.
You'll receive your comprehensive report within 15 minutes at ${data.email}.`);
                
                // Redirect to thank you page
                window.location.href = `thank-you.html?firstName=${encodeURIComponent(data.firstName)}&company=${encodeURIComponent(data.company)}&hasDataset=${!!window.uploadedDataset}`;
            }, 1500);
        });

        function getLeadValue(revenue) {
            const values = {
                'under-500k': '2,500-5,000',
                '500k-1m': '5,000-10,000', 
                '1m-5m': '10,000-25,000',
                '5m-20m': '25,000-75,000',
                'over-20m': '50,000-150,000'
            };
            return values[revenue] || '5,000-15,000';
        }

        startUrgencyTimer();
        setInterval(startUrgencyTimer, 60000);
    </script>
</body>
</html>
